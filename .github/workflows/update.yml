# .github/workflows/deploy.yml
name: ğŸš€ Auto Deploy Immobili - Agosto

on:
  schedule:
    - cron: '0 */4 * * *'  # Ogni 4 ore
  workflow_dispatch:       # Deploy manuale dal pulsante
  push:
    branches: [ main ]     # Ad ogni push su main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        npm install
        echo "âœ… Dipendenze installate"
        
    - name: ğŸ—ï¸ Build Immobili
      run: |
        echo "ğŸ”„ Avvio build sistema immobili..."
        node build140425.js
        echo "âœ… Build completato"
        
    - name: ğŸ“Š Verifica Output
      run: |
        if [ -f "index.html" ]; then
          echo "âœ… index.html generato correttamente"
          echo "ğŸ“ Dimensione file: $(wc -c < index.html) bytes"
        else
          echo "âŒ Errore: index.html non trovato!"
          exit 1
        fi
        
    - name: ğŸ“¤ Commit & Push Changes
      run: |
        git config --local user.email "francesco791-github@users.noreply.github.com"
        git config --local user.name "Francesco791 Auto-Deploy - Agosto"
        
        # Aggiungi solo i file necessari
        git add index.html
        git add last-build.json
        
        # Verifica se ci sono modifiche
        if git diff --cached --quiet; then
          echo "ğŸŸ¢ Nessuna modifica da committare"
        else
          echo "ğŸ“ Trovate modifiche, committando..."
          git commit -m "ğŸ”„ Auto-update immobili $(date '+%Y-%m-%d %H:%M UTC')"
          git push
          echo "âœ… Push completato con successo!"
        fi
        
    - name: ğŸ¯ Deploy Summary
      run: |
        echo "ğŸ  Deploy completato per repository: nuovosito_definitivo---Agosto"
        echo "ğŸŒ URL pubblico: https://francesco791.github.io/nuovosito_definitivo---Agosto/"
        echo "ğŸ“… Prossimo aggiornamento automatico: tra 4 ore"